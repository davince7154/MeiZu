<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://login.flyme.cn/favicon.ico" type="image/x-icon">
    <title>Flyme 账号 - 登录</title>
    <link rel="stylesheet" href="./css/reset.min.css">
    <link rel="stylesheet" href="./font_7gb0q1hmvky/iconfont.css">
    <link rel="stylesheet" href="./font_e7xejrk7lv/iconfont.css">
    <link rel="stylesheet" href="./css/common.min.css">
    <link rel="stylesheet" href="./css/login.min.css">
</head>

<body>
    <div id="header">
        <div class="login-wrap">
            <h1><a href="index.html"><img src="./images/logo.png" alt=""></a></h1>
        </div>
    </div>
    <div id="content">
        <div class="login-wrap">
            <div class="formBox">
                <h3>账号登陆</h3>
                <form action="" name="loginForm">
                    <input type="text" class="text-box" id="userphone" name="userphone" placeholder="11位手机号码"
                        maxlength="11">
                    <span id="username-text"></span>
                    <input type="password" class="text-box" id="password" name="password" placeholder="请输入密码"
                        maxlength="12">
                    <span id="password-text"></span>
                    <input type="text" class="text-box" id="image-code" name="imageCode" placeholder="请输入验证码"
                        maxlength="4">
                    <span id="image-code-text"></span><br>
                    <div class="check-box">
                        <input type="checkbox" name="checkbox" id="checkbox">
                        <span class="checkbox-text">是否7天免登录</span>
                    </div>
                </form>
                <button id="loginBtn">登陆</button>
                <a href="reg.html">注册</a>
            </div>
        </div>
    </div>
    <div id="footer">
        <div class="login-wrap">
            <div class="top clear-fix">
                <ul>
                    <li>关于魅族</li>
                    <li>工作机会</li>
                    <li>联系我们</li>
                    <li>法律声明</li>
                    <li>常见问题</li>
                    <li class="after-none">简体中文</li>
                </ul>
                <p>客服热线 400-788-3333</p>
                <a href="">在线客服</a>
            </div>
            <div class="bottom">
                <p>©2019 Meizu Telecom Equipment Co., Ltd. All rights reserved.    粤ICP备13003602号合字B2-20170010 营业执照 法律声明
                    粤公网安备 44049102496009 号</p>
            </div>
        </div>
    </div>
</body>

</html>

<script src="./js/jquery-3.2.1.min.js"></script>
<script src="./js/Cookie.js"></script>
<script>
    $(function () {
        $("#username").val(123456)
        $("#userphone").val(13245678910)
        $("#password").val("123asd")
        $("#password2").val("123asd")
        $("#image-code").val(1234)
        let regObj = {
            "userphone": {
                "regJs": "/^1[3-9]\\d{9}$/.test(val)",
                "msg": "电话号码格式错误，请重新填写",
                "isNull": "电话号码不能为空，请填写",
            },
            "password": {
                "regJs": "/^\\w{6,12}$/.test(val)",
                "msg": "密码格式错误，请重新填写",
                "isNull": "密码不能为空，请填写",
            },
            "image-code": {
                "regJs": "true",
                "msg": "验证码填写错误，请重新填写",
                "isNull": "验证码不能为空，请填写",
            }
        }
        $("form[name=regForm] input[type=text],input[type=password]").blur(function () {
            // 定义正则
            // 获取val
            //  匹配
            // 如果正
            // 如果负
            let val = $.trim($(this).val())
            let domId = $(this).attr("id")
            if ($(this).val() === "") {
                $(this).next().text(regObj[domId].isNull)
                $(this).addClass("active")
            } else if (!eval(regObj[domId].regJs)) {
                $(this).next().text(regObj[domId].msg)
                $(this).addClass("active")
            } else {
                $(this).next().text("")
                $(this).removeClass("active")
            }
        })
        $("#loginBtn").click(function () {
            if ($("form[name=regForm]").find(".active").length === 0) {
                let data = {
                    userphone: $("#userphone").val(),
                    userpass: $("#password").val()
                }
                $.ajax({
                    data,
                    url: "../server/login.php",
                    dataType: "json",
                    type: "post"
                }).done(function (data) {
                    if (data.status === "success") {
                        let cookie = new Cookie
                        if($("#checkbox").prop("checked")){
                            cookie.setCookie("user",$("#userphone").val(),7)
                        }else{
                            cookie.setCookie("user",$("#userphone").val())
                        }
                        let s = 3
                        $("h3").css("font-size", "18px").text(`登录成功，${s}秒后跳转主页`)
                        let myTimer = setInterval(() => {
                            s--
                            $("h3").text(`登录成功，${s}秒后跳转主页`)
                            if (s == 0) {
                                location.href = "index.html"
                                clearInterval(myTimer)
                                myTimer = null
                            }
                        }, 1000)
                    } else {
                        alert(data.msg)
                    }
                })
            } else {
                return
            }
        })
    })
</script>