<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://www.meizu.com/static/global/images/favicon-90c2e618ff.ico"
        type="image/x-icon">
    <title>魅族官网</title>
    <link rel="stylesheet" href="./css/reset.min.css">
    <link rel="stylesheet" href="./font_7gb0q1hmvky/iconfont.css">
    <link rel="stylesheet" href="./font_e7xejrk7lv/iconfont.css">
    <link rel="stylesheet" href="./css/common.min.css">
    <link rel="stylesheet" href="./css/index.min.css">
</head>

<body>
    <div id="header">
        <div class="index-wrap">
            <div id="" class="header-show">
                <h1><a href="index.html"><img src="./images/logo.png" alt=""></a></h1>
                <div class="right-box">
                    <div id="search-box">
                        <input type="text" placeholder="魅族 16T">
                        <em class="iconfont icon-fangdajing"></em>
                    </div>
                    <div id="user-box">
                        <img src="./images/blackUser.png" alt="">
                        <ul id="userList"></ul>
                    </div>
                    <div id="shoppingcart-box">
                        <a href="shoppingCart.html"><em class="iconfont icon-gouwuche"></em><em>0</em></a>
                        <ul class="hidden-box">
                            <li>
                                <dl>
                                    <dt><img src="https://openfile.meizu.com/group1/M00/07/CF/Cgbj0F61BXaARxdvAAqWtjjyY08964.png120x120.jpg"
                                            alt=""></dt>
                                    <dd>
                                        <p>魅族 17 Pro 晓芳窑艺术典藏版</p>
                                        <em>￥3999</em>
                                        <button>删除</button>
                                    </dd>
                                </dl>
                            </li>
                            <li class="border_none">
                                <dl>
                                    <dt><img src="https://openfile.meizu.com/group1/M00/07/CF/Cgbj0F61BXaARxdvAAqWtjjyY08964.png120x120.jpg"
                                            alt=""></dt>
                                    <dd>
                                        <p>魅族 17 Pro 晓芳窑艺术典藏版</p>
                                        <em>￥3999</em>
                                        <button>删除</button>
                                    </dd>
                                </dl>
                            </li>
                        </ul>
                    </div>
                </div>
                <nav>
                    <li><a href="">手机</a></li>
                    <li><a href="">声学</a></li>
                    <li><a href="">配件</a></li>
                    <li><a href="">生活</a></li>
                    <li><a href="">Flyme</a></li>
                    <li><a href="">服务</a></li>
                    <li><a href="">专卖店</a></li>
                    <li><a href="">社区</a></li>
                    <li><a href="">政企定制</a></li>
                    <li><a href="">APP下载</a></li>
                </nav>
            </div>
            <div class="header-hid"></div>
        </div>
    </div>
    <div id="banner">
    </div>
    <div id="content">
    </div>
    <div id="footer">
        <div class="top index-wrap clear-fix">
            <div class="left-box">
                <ul class="clear-fix">
                    <li><img src="https://fms.res.meizu.com/dms/2018/07/13/2c69bf7c-2d29-4fd4-852e-0aa497f36f51.png"
                            alt=""><span>满80免运费</span></li>
                    <li><img src="https://fms.res.meizu.com/dms/2018/07/13/d28eac8b-b915-49dc-9dbd-80884a07d44f.png"
                            alt=""><span>100+ 城市次日送达</span></li>
                    <li><img src="https://fms.res.meizu.com/dms/2018/07/13/b21f3e65-f7f4-4693-914c-c070faf96770.png"
                            alt=""><span>7天无理由退货</span></li>
                    <li><img src="https://fms.res.meizu.com/dms/2018/07/13/1998f0da-a439-4e07-9736-e6a1c39fb0ae.png"
                            alt=""><span>15天换货保障</span></li>
                    <li><img src="https://fms.res.meizu.com/dms/2018/07/13/420825c1-4763-436d-b3e1-721651ccc70c.png"
                            alt=""><span>1年免费保修</span></li>
                    <li><img src="https://fms.res.meizu.com/dms/2018/07/13/1c5cfeff-1b35-499e-bc2a-1fd29305be69.png"
                            alt=""><span>上门快修</span></li>
                </ul>
            </div>
            <div class="right-box">
                <p>周一至周日 8:00-20:00</p>
                <p>400-788-3333</p>
                <p>在线客服</p>
            </div>
        </div>
        <hr>
        <div class="bottom index-wrap clear-fix">
            <div class="left-box">
                <ul class="clear-fix">
                    <li>了解魅族</li>
                    <li>加入我们</li>
                    <li>联系我们</li>
                    <li>Flyme</li>
                    <li>魅族社区</li>
                    <li>天猫旗舰店</li>
                    <li>问题反馈</li>
                    <li>线上销售授权名单公示</li>
                    <li class="border_none">出版物经营许可证</li>
                </ul>
                <p>©2019 Meizu Telecom Equipment Co., Ltd. All rights reserved.    粤ICP备13003602号合字B2-20170010 营业执照 法律声明
                    粤公网安备 44049102496009 号</p>
            </div>
        </div>
    </div>
</body>

</html>

<script src="./js/jquery-3.2.1.min.js"></script>
<script src="./js/banner.js"></script>
<script src="./js/Cookie.js"></script>
<script>
    $(function () {

        // 获取轮播图
        $.ajax({
            url: "../server/getBanner.php",
            dataType: "JSON",
            success(data) {
                let a = new Banner({
                    imgs: data,
                    dom: $("#banner"),
                    moveTime: 300,
                    isLogin: new Cookie().getValue("user") ? true : false,
                    cutTime: 3000,
                    whiteUser: "./images/whiteUser.png",
                    blackUser: "./images/blackUser.png",
                    userDom: $("#user-box>img"),
                    navDom: $("#header .header-show").find("nav").find("a"),
                    carDom: $("#shoppingcart-box a").children().eq(0)
                })

            }
        })

        // 获取内容板块

        function makeP(data, url) {
            return new Promise((resolve, reect) => {
                $.ajax({
                    url: url,
                    data: data,
                    dataType: "json",
                    type: "post",
                    success(data) {
                        resolve(data)
                    },
                })
            })
        }
        let phone = makeP({ 'goods_type': '手机' }, "../server/getTypeBannerAndGoods.php")
        let listen = makeP({ 'goods_type': '声学' }, "../server/getTypeBannerAndGoods.php")
        let peijian = makeP({ 'goods_type': '配件' }, "../server/getTypeBannerAndGoods.php")
        let live = makeP({ 'goods_type': '生活' }, "../server/getTypeBannerAndGoods.php")
        Promise.all([phone, listen, peijian, live]).then(data => {


            // 中心内容区域
            let contentHtml = data.map(item => {
                if (item.length > 12) {
                    item.length = 12
                }
                let goodsListStr = item.map((ele, index) => {
                    return `<li class="goods-box ${(index + 1) % 4 === 0 ? "marginRight_none" : ""}" data-goodsId="${ele["goods_id"]}">
                                <img src="${ele["goods_color1"].split("||")[0]}" alt="">
                                <p class="goods-name">${ele["goods_name"]}</p>
                                <span class="goods-desc">${ele["goods_desc"]}</span>
                                <span class="goods-price"><em>￥</em>${ele["goods_price"]}</span>
                            </li>`
                }).join("")
                return `    <div class="section">
                                <div class="section-title">
                                    <h2>${item[0]["goods_type"]}</h2>
                                </div>
                                <div class="section-banner">
                                    <a href=""><img src="${item[0]["image"]}" alt=""></a></div>
                                <div class="section-list index-wrap">
                                    <ul class="clear-fix">${goodsListStr}</ul>
                                </div>
                            </div>`
            })

            $("#content").html(contentHtml)
            $("#content .goods-box").click(function () {
                open(`goods.html?goodsId=${$(this).data("goodsid")}`)
            })

            // 二级菜单内容区域

            let navStr = data.map((item, index) => {
                if (item.length > 8) {
                    item.length = 8
                }
                return `<ul>${item.map((e, i) => `<li data-goodsid="${e["goods_id"]}"><img src="${e["goods_color1"].split("||")[0]}" alt=""><span>${e["goods_name"]}</span><i>￥</i><em>${e["goods_price"]}</em></li>`).join("")}</ul>`
            }).join("")

            $("#header .index-wrap .header-hid").html(navStr)


            $("#header .index-wrap nav").mouseover(function () {
                // 鼠标在导航栏上，二级菜单显示
                $(this).parents("#header").css({ "background": "#fff", "border-bottom": "solid 1px #e9e9e9" }).animate({ "height": "265px" }, 500).end().css("height", "100%")
                $(this).parent().siblings(".header-hid").css("display", "block")

                // 二级菜单显示，字体显示未黑色
                $(this).attr("data-color", $(this).find("a").css("color")).find("a").css("color", "#666")
                $(this).parent().find("#user-box").attr("data-img", $(this).parent().find("#user-box").find("img").attr("src")).find("img").attr("src", "./images/blackUser.png")
                $(this).parent().find("#shoppingcart-box").attr("data-color", $(this).parent().find("#shoppingcart-box").find("em").eq(0).css("color")).find("em").eq(0).css("color", "#666")
            })
            $("#header").mouseleave(function () {
                // 鼠标在导航栏上，二级菜单收起
                $(this).css({ "height": "80px", "background": "none", "border-bottom": "none" })
                $(this).find(".header-hid").css({ "display": "none" })

                // 二级菜单关闭，字体显示为二级菜单未显示的状态
                $(this).find("nav").find("a").css("color", $(this).find("nav").attr("data-color"))
                $(this).find("#user-box").find("img").attr("src", $(this).find("#user-box").attr("data-img"))
                $(this).find("#shoppingcart-box").find("em").eq(0).css("color", $(this).find("#shoppingcart-box").attr("data-color"))
            })

            $("#header .index-wrap .header-show nav li").each((i, e) => {
                //  鼠标在导航栏上，根据不同的类型，显示不同的内容

                if (i <= 3) {
                    $(e).mouseover(function () {
                        $(this).find("a").css("color", "blue")
                        $("#header .index-wrap .header-hid ul").eq(i).css("display", "block").siblings().css("display", "none")
                    })
                }
            })

            // 点击二级菜单的商品，跳转到对应的商品页面
            $(".header-hid ul li").click(function () {
                open(`goods.html?goodsId=${$(this).data("goodsid")}`)
            })

        })


        // 鼠标在用户头像事件 

        let cookie = new Cookie
        let userListHtml = ""
        if (cookie.getValue("user")) {
            userListHtml = `<li id="loginBtn"><a href="login.html"> 登录</a></li>
                        <li id="regBtn"><a href="reg.html"> 注册</a></li>
                        <li id="reBtn"><a href="">注销</a></li>`
            $("#user-box img").prop("src", "./images/user.png")
            $.ajax({
                data: `userphone=${cookie.getValue("user")}`,
                type: "post",
                url: "../server/getUser.php",
                success(data) {
                    alert("欢迎回来：" + data)
                }
            })
        } else {
            userListHtml = `<li id="loginBtn"><a href="login.html"> 登录</a></li><li id="regBtn"><a href="reg.html"> 注册</a></li>`
        }
        $("#userList").html(userListHtml)

        // 注销按钮
        $("#reBtn").click(function () {
            cookie.removeCookie("user")
        })

        $("#user-box").mouseover(function () { $(this).children("#userList").css("display", "block") })
        $("#userList").mouseleave(function () { $(this).css("display", "none") })

        // 购物车下拉列表事件
        $("#shoppingcart-box").mouseover(function () {
            $(this).find(".hidden-box").css("display", "block")
        })
        $("#shoppingcart-box .hidden-box").mouseleave(function () {
            $(this).css("display", "none")
        })

    })
</script>